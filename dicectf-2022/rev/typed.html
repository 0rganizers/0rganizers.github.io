<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>typed | Organisers</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="typed" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CTF Team" />
<meta property="og:description" content="CTF Team" />
<link rel="canonical" href="https://org.anize.rs/dicectf-2022/rev/typed.html" />
<meta property="og:url" content="https://org.anize.rs/dicectf-2022/rev/typed.html" />
<meta property="og:site_name" content="Organisers" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="typed" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"CTF Team","headline":"typed","url":"https://org.anize.rs/dicectf-2022/rev/typed.html"}</script>
<!-- End Jekyll SEO tag -->


    <meta property="og:image" content="https://org.anize.rs/assets/images/logo.png" />
    <meta name="twitter:card" content="summary" />
    <!-- TODO <meta name="twitter:description" content="" /> -->
    <meta name="twitter:title" content="Organisers" />
    <meta name="twitter:site" content="@0rganizers" />
    <!-- TODO <meta name="twitter:image" content="" /> -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#040d21">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Hack monospace font -->
    <link rel='stylesheet' href='//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css'>
    <link rel="stylesheet" href="/assets/css/style.css?v=72a10f3b5424719665e31ae90a083fdf32243ce7">
    <link rel="stylesheet" href="/assets/css/highlight.css?v=72a10f3b5424719665e31ae90a083fdf32243ce7">
    <link rel="stylesheet" href="/assets/css/light.css?v=72a10f3b5424719665e31ae90a083fdf32243ce7">

    <!-- legitimize current Mastodon profile via link verification -->
    <link rel="me" href="https://infosec.exchange/@organizers" />


    <script type="text/javascript">
        function isLightThemeSelected() {
          return document.cookie.match(/theme=light/i) != null
        }

        function setThemeFromCookie() {
            var html = document.getElementsByTagName('html')[0]
            html.className = isLightThemeSelected() ? 'light-theme' : 'dark-theme'
            console.log('Loaded cookie: ' + document.cookie)
        }

        (function() {
          setThemeFromCookie()
        })();
    </script>

    <script type="text/javascript">
        function getFootnoteContent(linkId) {
            const fnId = linkId.replace(/^fnref/, 'fn');
            return document.getElementById(fnId).querySelector("p").innerHTML;
        }

        function addFootnote(element, content) {
            const footnote = document.createElement('div');
            footnote.classList.add('footnote-box');
            // Also add the footnote number
            footnote.innerHTML = `<sup>${element.innerText}</sup> ${content}`;
            footnote.querySelectorAll('a.reversefootnote').forEach((backlink) => {
                footnote.removeChild(backlink);
            });
            element.insertAdjacentElement('afterend', footnote);
            element.dataset.toggled = '1';
        }

        function removeFootnote(element) {
            element.parentElement.removeChild(element.nextSibling);
            element.dataset.toggled = '0';
        }


        window.addEventListener("load", function() {
            document.querySelectorAll("a.footnote").forEach((el) => {
                const sup = el.parentElement;
                el.addEventListener("click", (event) => {
                    const isOpen = Number.parseInt(sup.dataset.toggled || '0');
                    if (!isOpen) {
                        addFootnote(sup, getFootnoteContent(sup.id));
                    } else {
                        removeFootnote(sup);
                    }
                    event.preventDefault();
                });
            });
        });
    </script>

    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      "HTML-CSS": {
        fonts: ["Gyre-Pagella"],
        imageFont: null,
        undefinedFamily: "'Arial Unicode MS', cmbright"
      },
      tex2jax: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        processEscapes: true
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_HTML"></script>
  </head>
  
  <body> 
    <header class="page-header-simple" role="banner">
      
      <div class="left-links"><a id="header-logo" href="/">Organi{s|z}ers</a></div>
      <div class="right-links">
        <a href="/writeups">Writeups</a>
        <a href="/achievements">Achievements</a>
      </div>
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="typed">typed</h1>

<p><strong>Authors:</strong> Robin_Jadoul</p>

<p><strong>Tags:</strong> rev, rust</p>

<p><strong>Points:</strong> 362 (8 solves)</p>

<p><strong>Challenge Author:</strong> aplet123</p>

<p><strong>Description:</strong>
<del>Haskell</del> Rust is a dynamically typed, interpreted language. Can you get my code to stop erroring?</p>

<h2 id="lay-of-the-land">Lay of the land</h2>

<p>A reversing challenge where we’re given the <a href="/dicectf-2022/rev/typed.rs">source code</a>.
How hard could it be?</p>

<p>Alright, so it’s clearly not as trivial as having source code makes it sound,
but typelevel metaprogramming is fun and often follows some recognizable patterns.
Let’s first have a look at the general outline:</p>

<ul>
  <li>Some types and traits are defined to represent data/values and operations on those</li>
  <li>Some of those operations induce constraints that should be satisfied on the data</li>
  <li>The flag is defined with a new type alias per character</li>
  <li>We perform some operations on and add some constraints to the flag characters</li>
  <li>If it typechecks, the program compiles and outputs the flag when run</li>
</ul>

<h2 id="eyes-on-the-prize">Eyes on the prize</h2>

<p>So let’s have a look at how the final constraints are defined:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">DanceDanceGice</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">DanceDanceGong</span> <span class="k">as</span> <span class="n">DanceGang</span><span class="o">&gt;</span><span class="p">::</span><span class="n">DidGong</span><span class="p">;</span>
<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">print_flag</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">_</span><span class="p">:</span> <span class="n">DanceDanceGice</span> <span class="o">=</span> <span class="nd">panic!</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>All weird naming aside, we just need <code class="language-plaintext highlighter-rouge">DanceDanceGice</code> to be a valid type, and hence for <code class="language-plaintext highlighter-rouge">DanceDanceGong</code> to
implement the <code class="language-plaintext highlighter-rouge">DanceGang</code> trait.
The associated type <code class="language-plaintext highlighter-rouge">DidGong</code> of that <code class="language-plaintext highlighter-rouge">DanceGang</code> trait will then be a valid type.</p>

<p>Looking a bit higher in the file, we can see this calling into some more constraints, and eventually getting
into some massive line of code the does a bunch of different things with the flag characters.
I’ll consider the margins of this theoretically infinitely large webpage as too small to reproduce the monstrosity here.<sup id="fnref:walloftext" role="doc-noteref"><a href="#fn:walloftext" class="footnote" rel="footnote">1</a></sup></p>

<p>Now, it’s time to really go in the deep end.
We’ll go all the way back to the top of the file, and try to identify what’s going on.</p>

<h2 id="look-mom-i-can-do-mathematics">Look mom, I can do mathematics</h2>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">#![recursion_limit</span> <span class="nd">=</span> <span class="s">"10000"</span><span class="nd">]</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">marker</span><span class="p">::</span><span class="n">PhantomData</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">DidGongGong</span><span class="o">&lt;</span><span class="n">DiceDiceGice</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PhantomData</span><span class="o">&lt;</span><span class="n">DiceDiceGice</span><span class="o">&gt;</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">DangGong</span><span class="p">;</span>
<span class="k">trait</span> <span class="n">DangGangGang</span><span class="o">&lt;</span><span class="n">DidGang</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">DidGong</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">DiceDiceGice</span><span class="o">&gt;</span> <span class="n">DangGangGang</span><span class="o">&lt;</span><span class="n">DangGong</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">DiceDiceGice</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">DidGong</span> <span class="o">=</span> <span class="n">DiceDiceGice</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">DiceDiceGice</span><span class="p">,</span> <span class="n">DanceDanceGig</span><span class="o">&gt;</span> <span class="n">DangGangGang</span><span class="o">&lt;</span><span class="n">DidGongGong</span><span class="o">&lt;</span><span class="n">DanceDanceGig</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">DiceDiceGice</span>
<span class="k">where</span>
    <span class="n">DiceDiceGice</span><span class="p">:</span> <span class="n">DangGangGang</span><span class="o">&lt;</span><span class="n">DanceDanceGig</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">type</span> <span class="n">DidGong</span> <span class="o">=</span> <span class="n">DidGongGong</span><span class="o">&lt;&lt;</span><span class="n">DiceDiceGice</span> <span class="k">as</span> <span class="n">DangGangGang</span><span class="o">&lt;</span><span class="n">DanceDanceGig</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="n">DidGong</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Alright, very first line, let’s ask the rust compiler for some mercy, because we’re about to hurt it.
<del>This will be fun.</del>
Then some import to make our types happy if we don’t actually make them inhabited, and off we go.</p>

<p>Now, let’s see:</p>

<ul>
  <li>We have two structs that are related: an empty struct, and a struct that contains <em>some</em> other type, but only kinda. (Since we never actually instantiate our types)</li>
  <li>And then we can define some operation on those types, where we juggle around the <code class="language-plaintext highlighter-rouge">DangGangGang</code> wrapper.</li>
</ul>

<p>My eyes are already watering, let’s try some renaming.
We’re dealing with operations, and that <code class="language-plaintext highlighter-rouge">DidGong</code> name looks familiar from before.
Let’s just call it <code class="language-plaintext highlighter-rouge">Result</code> from now on.<sup id="fnref:naming" role="doc-noteref"><a href="#fn:naming" class="footnote" rel="footnote">2</a></sup>
Then, let’s try to think what this is doing, is it ringing any bells yet?
What else could it be than our ever beloved <a href="https://en.wikipedia.org/wiki/Peano_axioms">Peano arithmetic</a> of course.
Some more renaming, and suddenly things are looking <del>a lot</del> maybe somewhat more readable.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PhantomData</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">Zero</span><span class="p">;</span>

<span class="k">trait</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">Zero</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">T</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">Succ</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">T</span>
<span class="k">where</span>
    <span class="n">T</span><span class="p">:</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;&lt;</span><span class="n">T</span> <span class="k">as</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And you know what, now that we’ve defined this, let’s just get some convenience out of the way and
rename some of the numerals that we see popping up throughout the rest of the file.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">One</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Zero</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Two</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">One</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Three</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Two</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Four</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Three</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Five</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Four</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Six</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Five</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Seven</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Six</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Eight</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Seven</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Nine</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Eight</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">type</span> <span class="n">Ten</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">Nine</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div></div>

<p>Beautiful, isn’t it?</p>

<p>To finish off the arithmetic part, we’ll want some more operations<sup id="fnref:lonely-addition" role="doc-noteref"><a href="#fn:lonely-addition" class="footnote" rel="footnote">3</a></sup>.
So, without hurting our eyes again with the original code, I present you with the rename operations.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="n">Mult</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Mult</span><span class="o">&lt;</span><span class="n">Zero</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">T</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">Zero</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span> <span class="n">Mult</span><span class="o">&lt;</span><span class="n">Succ</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">T</span>
<span class="k">where</span>
    <span class="n">T</span><span class="p">:</span> <span class="n">Mult</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">T</span><span class="p">:</span> <span class="nb">Add</span><span class="o">&lt;&lt;</span><span class="n">T</span> <span class="k">as</span> <span class="n">Mult</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">T</span> <span class="k">as</span> <span class="nb">Add</span><span class="o">&lt;&lt;</span><span class="n">T</span> <span class="k">as</span> <span class="n">Mult</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">trait</span> <span class="n">SubAndAssertPositive</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">SubAndAssertPositive</span><span class="o">&lt;</span><span class="n">Zero</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">T</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span> <span class="n">SubAndAssertPositive</span><span class="o">&lt;</span><span class="n">Succ</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="k">where</span>
    <span class="n">T</span><span class="p">:</span> <span class="n">SubAndAssertPositive</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">T</span> <span class="k">as</span> <span class="n">SubAndAssertPositive</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">trait</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">Zero</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Zero</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">Zero</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">Zero</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">One</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">Zero</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">One</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="o">&gt;</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">Succ</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<span class="k">where</span>
    <span class="n">T</span><span class="p">:</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">T</span> <span class="k">as</span> <span class="n">NotEqual</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Now there’s one more thing that’s interesting to remark here:
when we try to instantiate the <code class="language-plaintext highlighter-rouge">SubAndAssertPositive</code> trait, it’ll only work when <code class="language-plaintext highlighter-rouge">T</code> represents a number greater than <code class="language-plaintext highlighter-rouge">V</code>.
Hence this is the first type-level constraint that we encounter and that’ll be used to enforce the correct values of our flag.
You’d almost start to think I put actual thought into renaming these things.</p>

<h2 id="mama-just-made-a-lisp">Mama, just made a lisp</h2>

<p>Alright, that’s the first part out of the way, we’re mostly done dealing with the simple arithmetic now.
Now, we first introduce some more data, and then we’ll skip a bit ahead because things become repetitive, and dare I say almost boring.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">DiceGice</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">DiceGig</span><span class="o">&lt;</span><span class="n">DanceGigGig</span><span class="p">,</span> <span class="n">DiceDiceGice</span><span class="o">&gt;</span><span class="p">(</span><span class="n">PhantomData</span><span class="o">&lt;</span><span class="n">DanceGigGig</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">PhantomData</span><span class="o">&lt;</span><span class="n">DiceDiceGice</span><span class="o">&gt;</span><span class="p">);</span>
</code></pre></div></div>

<p>We see an empty type/data/value thing again, and something that contains two other types/values.
I suppose you could call it a pair?
Nah, for obvious reasons, we’ll give it a more friendly name: <code class="language-plaintext highlighter-rouge">Cons</code>.
Our friend <code class="language-plaintext highlighter-rouge">DiceGice</code> shall furthermore henceforth be known under the name <code class="language-plaintext highlighter-rouge">Nil</code>.</p>

<p>Skipping ahead, we come to the next interesting part:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="n">DanceGang</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// snip</span>
<span class="k">impl</span> <span class="n">DanceGang</span> <span class="k">for</span> <span class="n">Zero</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">Zero</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">DanceGang</span> <span class="k">for</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">Succ</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">impl</span> <span class="n">DanceGang</span> <span class="k">for</span> <span class="nb">Cons</span><span class="o">&lt;</span><span class="n">DidGig</span><span class="p">,</span> <span class="n">DiceGice</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="n">DiceGice</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">DanceGang</span> <span class="k">for</span> <span class="nb">Cons</span><span class="o">&lt;</span><span class="n">DidGig</span><span class="p">,</span> <span class="nb">Cons</span><span class="o">&lt;</span><span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;&gt;</span>
<span class="k">where</span>
    <span class="n">R</span><span class="p">:</span> <span class="n">DanceGang</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">type</span> <span class="nb">Result</span> <span class="o">=</span> <span class="nb">Cons</span><span class="o">&lt;&lt;</span><span class="n">R</span> <span class="k">as</span> <span class="n">DanceGang</span><span class="o">&gt;</span><span class="p">::</span><span class="nb">Result</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><a href="https://youtu.be/S74rvpc6W60?t=9">Oh no!</a>
It looks like we’re evaluating lists of the form <code class="language-plaintext highlighter-rouge">(operation value0 value1 ...)</code>.</p>

<blockquote>
  <p>I’m afraid you have a lisp sir, and it’s incurable.</p>
</blockquote>

<p>Cutting an already overly long story short, we’ve got a bunch of different “functions” that perform some pattern matching
and have some computations associated with it.
Classical and expected examples of course include things such as:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Sum</code></li>
  <li><code class="language-plaintext highlighter-rouge">Product</code></li>
  <li><code class="language-plaintext highlighter-rouge">Map</code></li>
</ul>

<p>There are some less expected but not overly hard operations like:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">EveryThird</code></li>
  <li><code class="language-plaintext highlighter-rouge">SkipEveryThird</code></li>
  <li><code class="language-plaintext highlighter-rouge">AssertAllEqual</code></li>
</ul>

<p>However, once you start naming things like this, it’s time to realize you have a problem, and intervene:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">WTF1</code></li>
  <li><code class="language-plaintext highlighter-rouge">WTF2</code></li>
  <li><code class="language-plaintext highlighter-rouge">WeirdEquals</code></li>
  <li><code class="language-plaintext highlighter-rouge">WeirdNotEquals</code></li>
</ul>

<p>So to avoid boring my readers entirely to death, I’ll just give you the opportunity to read my <a href="/dicectf-2022/rev/typed_rev.rs">reworked source code</a>
at the point where I decided to give up on trying to understand it.</p>

<h2 id="do-you-even-lift-bro">Do you even lift, bro?</h2>

<p>It was around this point that I decided I’d rather painstakingly reimplement each of these instructions in what most
people would consider to be a more normal programming language than this lisp, while trying to stay as close to the original
to avoid getting bugs lost in translation.</p>

<p>First things first, as there’s still a massive wall of text to be processed, we’ll have to deal with that.
I do not want to manually rewrite it, and I’m a bit afraid to mess things up if I start doing it with vim macros and regex replaces.<sup id="fnref:vim" role="doc-noteref"><a href="#fn:vim" class="footnote" rel="footnote">4</a></sup>
So that leaves us with one real options: we’ll have to parse it.
String wrangling is error-prone and tricky, so let’s search google for some arbitrary python-based implementation of parser combinators.<sup id="fnref:parsing" role="doc-noteref"><a href="#fn:parsing" class="footnote" rel="footnote">5</a></sup><sup id="fnref:monads" role="doc-noteref"><a href="#fn:monads" class="footnote" rel="footnote">6</a></sup></p>

<p>We don’t really care about any kind of whitespace and ignoring token separation makes it easier, so we’ll just strip all of that out.
Introduce a our friends <code class="language-plaintext highlighter-rouge">Cons</code> and <code class="language-plaintext highlighter-rouge">Nil</code> to the big friendly snake, find some shortcut to evaluate operations, and we can actually parse and consume the entire wall of text. (The implementation of <code class="language-plaintext highlighter-rouge">Eval</code> is left open below, since that was refactored to use the rest of what I’ll describe below in a later iteration)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">parsy</span> <span class="k">as</span> <span class="n">P</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">Nil</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<span class="n">Cons</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">"Cons"</span><span class="p">,</span> <span class="s">"head tail"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">Oper</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s">"Add"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Eval</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">+</span> <span class="n">Eval</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="c1"># Not technically Eval, but good enough for constant values
</span>    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s">"Mult"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Eval</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">*</span> <span class="n">Eval</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="c1"># Not technically Eval, but good enough for constant values
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="n">op</span>

<span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"Zero"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">"One"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">"Two"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"Three"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s">"Four"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s">"Five"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s">"Six"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s">"Seven"</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s">"Eight"</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s">"Nine"</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
        <span class="s">"Ten"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s">"Hundred"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="p">}</span>
<span class="n">lits</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s">"Sum Prod EvalBothAndSub ApplyAll WTF1 AssertAllEqual AssertNotEqual Map WeirdEquals WeirdNotEquals EveryThird SkipEveryThird Apply Nil"</span><span class="p">.</span><span class="n">split</span><span class="p">()}</span>

<span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="n">pExpr</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">forward_declaration</span><span class="p">()</span>

    <span class="o">@</span><span class="n">P</span><span class="p">.</span><span class="n">generate</span>
    <span class="k">def</span> <span class="nf">pCons</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"Cons&lt;"</span><span class="p">)</span>
        <span class="n">head</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">pExpr</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">","</span><span class="p">)</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">pExpr</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"&gt;"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Cons</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>

    <span class="o">@</span><span class="n">P</span><span class="p">.</span><span class="n">generate</span>
    <span class="k">def</span> <span class="nf">pOper</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">)</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">pExpr</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"as"</span><span class="p">)</span>
        <span class="n">op</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"Add"</span><span class="p">)</span> <span class="o">|</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"Mult"</span><span class="p">)</span> <span class="o">|</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"SubAndAssertPositive"</span><span class="p">)</span> <span class="o">|</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"NotEqual"</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"&lt;"</span><span class="p">)</span>
        <span class="n">rhs</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">pExpr</span>
        <span class="k">yield</span> <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="s">"&gt;&gt;::Result"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Oper</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>


    <span class="n">literals</span> <span class="o">=</span> <span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">.</span><span class="n">keys</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="sa">f</span><span class="s">"Flag</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">"</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
            <span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="n">P</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lits</span><span class="p">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span>
    <span class="n">pLit</span> <span class="o">=</span> <span class="n">literals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">literals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="n">pLit</span> <span class="o">|=</span> <span class="n">n</span>

    <span class="n">pExpr</span><span class="p">.</span><span class="n">become</span><span class="p">(</span><span class="n">pCons</span> <span class="o">|</span> <span class="n">pOper</span> <span class="o">|</span> <span class="n">pLit</span><span class="p">)</span>
        
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">).</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pExpr</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</code></pre></div></div>

<p>Now we can start re-implementing each of our lispy operations in new functions, which gets heavily spiced with <code class="language-plaintext highlighter-rouge">isNil</code> and <code class="language-plaintext highlighter-rouge">isCons</code> calls,
because that was the most braindead and mechanical way I could still think of to perform the typesystem’s pattern matching.
I’ll humour you with the implementations of <code class="language-plaintext highlighter-rouge">Eval</code> and <code class="language-plaintext highlighter-rouge">WeirdEquals</code>, and leave the rest to the <a href="/dicectf-2022/rev/typed_solver.py">final implementation</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">Eval</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">numbers</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lits</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lits</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"Flag"</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Flag</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:])]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z3</span><span class="p">.</span><span class="n">ExprRef</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Cons</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Eval</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">head</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">WeirdEquals</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">isCons</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isNil</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">tail</span><span class="p">):</span>
        <span class="n">sxyt</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">head</span>
        <span class="k">if</span> <span class="n">isCons</span><span class="p">(</span><span class="n">sxyt</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isCons</span><span class="p">(</span><span class="n">sxyt</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">tail</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sxyt</span><span class="p">.</span><span class="n">head</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">sxyt</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">head</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">sxyt</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">tail</span>
            <span class="k">if</span> <span class="n">isCons</span><span class="p">(</span><span class="n">yt</span><span class="p">.</span><span class="n">tail</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isNil</span><span class="p">(</span><span class="n">yt</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">tail</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">yt</span><span class="p">.</span><span class="n">head</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">yt</span><span class="p">.</span><span class="n">tail</span><span class="p">.</span><span class="n">head</span>
                <span class="k">return</span> <span class="n">Cons</span><span class="p">(</span><span class="s">"AssertAllEqual"</span><span class="p">,</span> <span class="n">Cons</span><span class="p">(</span><span class="n">Cons</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Cons</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Cons</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Nil</span><span class="p">))),</span> <span class="n">Cons</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">Nil</span><span class="p">)))</span>
    <span class="k">assert</span> <span class="bp">False</span>
</code></pre></div></div>

<p>From that point onwards, it’s a surprisingly simple matter to add in symbolic variables and constraint enforcement with
the ever-glorious <a href="https://github.com/Z3Prover/z3">z3 solver</a>.
The gist of it is: when evaluating a flag character, use its corresponding symbolic variable instead; when you encounter something
for which you put <code class="language-plaintext highlighter-rouge">Assert</code> in the name earlier, add in a constraint on the global variable<sup id="fnref:global" role="doc-noteref"><a href="#fn:global" class="footnote" rel="footnote">7</a></sup> containing the solver object.</p>

<h2 id="let-it-simmer-a-bit-and-serve-hot">Let it simmer a bit and serve hot</h2>

<p>We clench our cheeks together, place our salt wards shaped as parentheses, pray to our favourite deities,
type <code class="language-plaintext highlighter-rouge">python typed_solver.py</code> and hope for the best.
We let it run for a while, have discord crash on us, almost run out of memory because we’re doing way too much at once,
and fear that z3 the magnificent might not be able to do it.</p>

<p>Shortly after that, a flag appears.
Sometimes fears are completely unfounded, it would appear.</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">dice{l1sp_insid3_rus7_9afh1n23}</code></p>
</blockquote>

<h2 id="closing-thoughts">Closing thoughts</h2>

<p>I would love to write as good a post and be as witty as the <a href="https://aphyr.com/posts/342-typing-the-technical-interview">inspiration for the challenge description</a>, but I’m afraid you’ll have to make do with what this turned out as.
Nevertheless, as it turns out, type-level programming can be a lot of fun, and exercising the rust compiler
is a nice way to pass the time.
I’d like to thank aplet123 for this lovely challenge, and my teammates for suffering through my complaints
about how horrible a lisp implemented in the rust typesystem is while trying to reverse engineer it.
Maybe I should try to make an internet law out of the statement “A good CTF challenge is pain while solving it, and fun only in retrospect.” :)<sup id="fnref:internet-law" role="doc-noteref"><a href="#fn:internet-law" class="footnote" rel="footnote">8</a></sup></p>

<hr />
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:walloftext" role="doc-endnote">
      <p>And while I must already assume some level of masochism given that you are reading this post, I will consider it a kindness on my part towards the hypothetical reader’s sanity. <a href="#fnref:walloftext" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:naming" role="doc-endnote">
      <p>I low-key think of these types as being bullied by me and being referred to by another name against their will now. Should I feel bad about this? <a href="#fnref:naming" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:lonely-addition" role="doc-endnote">
      <p>We wouldn’t want our little friend that we’re so harshly calling <code class="language-plaintext highlighter-rouge">Add</code> instead of <code class="language-plaintext highlighter-rouge">DangGangGang</code>, to feel lonely, now would we? <a href="#fnref:lonely-addition" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:vim" role="doc-endnote">
      <p>I shall remark here – it’s been a while since I last interjected with a footnote, sorry for that – that I may or may not have tried to do exactly that earlier and may or may not have messed it up. Sometimes mysteries are simply meant to remain mysteries. <a href="#fnref:vim" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:parsing" role="doc-endnote">
      <p>In the given situation one might feel the need to stick to something familiar. Unfortunately, after sufficient mind-warping the functional-programming-inspired parsing paradigm is what starts to feel familiar now. <a href="#fnref:parsing" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:monads" role="doc-endnote">
      <p>The particular library I ended up with used what the challenge author later referred to as “discount monads”, implemented with generators/coroutines. <a href="#fnref:monads" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:global" role="doc-endnote">
      <p>It’s CTF code, written after staring into the abyss for too long, don’t hate me! <a href="#fnref:global" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:internet-law" role="doc-endnote">
      <p>Tell your friends you heard it here first! <a href="#fnref:internet-law" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>




<!--       <footer class="site-footer">
        <a href="https://twitter.com/0rganizers">Twitter</a> | <a id="changeTheme" class="btn-toggle">Dark-Mode</a>
      </footer> -->

      <div class="lever-meme">
        <div id="lever" class="lever-off"></div>
      </div>

      <div class="twitter">
        <a href="https://twitter.com/0rganizers"><img src="/assets/images/twitter.svg"></a>
      </div>

      <script>
        let leverCount = 0;
        let manic = false;

        function resetLever() {
            leverCount = 0;
            setTimeout(resetLever, 1750);
        }

        resetLever();

        document.getElementById('lever')
        .addEventListener('click', function (event) {
          if(leverCount > 10){
            manic = true;
            document.getElementById("lever").classList.add('lever-manic');
            document.getElementById("header-logo").classList.add('rainbow');
          }

          if(!manic){
            document.getElementById("lever").classList.toggle('lever-on');
            ++leverCount;
          }
        });


      </script>

      <script>
      function updateThemeToggleFooter() {
        let elem = document.querySelector('#lever');
        // elem.innerHTML = isLightThemeSelected() ? 'Dark Mode' : 'Light Mode'
      }

      (function() {
        updateThemeToggleFooter()
      })();

      function togglePageContentLightDark() {
          var html = document.getElementsByTagName('html')[0]
          var currentClass = html.className
          var newClass = html.className == 'dark-theme' ? 'light-theme' : 'dark-theme'
          html.className = newClass

          document.cookie = 'theme=' + (newClass == 'light-theme' ? 'light' : 'dark') + '; SameSite=Strict; path=/; expires=Fri, 31 Dec 9999 23:59:59 GMT'
          console.log('Cookies are now: ' + document.cookie)

          updateThemeToggleFooter()
      }

      const btn = document.querySelector("#lever");
      btn.addEventListener("click", function() {
        togglePageContentLightDark();
      });
      </script>
    </main>
  </body>
</html>
